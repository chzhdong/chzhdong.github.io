---
title: RabbitMQ
published: 2025-02-06
description: 'RabbitMQ Tutorial'
image: ''
tags: ["RabbitMQ"]
category: 'Tool'
draft: false 
lang: 'zh_CN'
---

## 简介

对于 RabbitMQ，其主要实现的就是消息代理，在消息发送者和消息接收者之间实现异步调用；

对于 RabbitMQ 存在多种类型的交换机，包括 fanout、direct、topic，即广播、直传、订阅等；对于消息代理，需要通过交换机和队列进行绑定，从而实现消息的分发，而接收者直接等待对应队列的消息即可。

为了实现用户隔离，RabbitMQ 实现了用户隔离，即不同用户之间的隔离；virtual host，即用户可以创建不同的

virtual host 来实现对应的隔离效果。

## 可靠性

### 发送者可靠性

为了保障发送者的可靠性，可以基于以下方法：

- SpringAMQP 发现消息发送失败，可以多次重试发送消息；
- 对于已经发送到 MQ，但由于内部异常导致的问题，可以通过确认机制保障；Publisher Return 在路由失败是返回回执消息，Publisher Confirm 对于MQ 中临时消息或者持久化消息进行分别处理，返回 ACK 或 NACK；

### MQ 可靠性

对于 MQ 中消息存储在内存，由于宕机等问题导致消息消失，以下提供的解决方案：

- 交换机、队列、消息持久化，也就是将消息保存在磁盘上，而非内存；
- Lazy Queue：接收到消息直接存储在磁盘，需要消费从磁盘读取到内存；

### 消费者可靠性

由于消费者不一定成功消费了消息，有以下解决方案：

- 消费者向 MQ 提供回执，即 ACK、NACK、REJECT；
- 当消息处理失败后，可以重新尝试重新入队、抛弃、或者投放到指定的交换机；
- 对于消息的幂等性，可以通过消息的唯一ID解决或者业务代码本身解决；

## 延迟消息

对于消费失败、队列已满溢出、TTL 已到的消息会转移到死信交换机进行处理；基于死信交换机，通过设置对应的 TTL，即可实现 TTL 对应时间的延迟消息。

通过 DelayExchange 插件来增强 RabbitMQ 的功能以实现延迟消息；
